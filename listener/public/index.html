<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitville APM Dashboard</title>
  <!-- Pico CSS for semantic styling (11KB) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header class="container">
    <nav>
      <ul>
        <li><strong>Bitville APM</strong></li>
      </ul>
      <ul>
        <li><a href="#" id="nav-requests" class="active">Requests</a></li>
        <li><a href="#" id="nav-stats">Statistics</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <!-- Search/Filter Section -->
    <section id="search-section">
      <form id="search-form" role="search">
        <div class="grid">
          <div>
            <label for="project-filter">Project</label>
            <select id="project-filter" name="project">
              <option value="">All Projects</option>
              <!-- Populated dynamically -->
            </select>
          </div>
          <div>
            <label for="url-filter">URL Pattern</label>
            <input type="text" id="url-filter" name="url" placeholder="/api/users">
          </div>
          <div>
            <label for="duration-min">Min Duration (ms)</label>
            <input type="number" id="duration-min" name="duration_min" placeholder="500">
          </div>
        </div>
        <div class="grid">
          <div>
            <label for="source-filter">Source</label>
            <select id="source-filter" name="source">
              <option value="">All Sources</option>
              <option value="php_agent">PHP Agent</option>
              <option value="postgres_agent">Postgres Agent</option>
            </select>
          </div>
          <div>
            <label for="date-start">Start Date</label>
            <input type="datetime-local" id="date-start" name="timestamp_start">
          </div>
          <div>
            <label for="date-end">End Date</label>
            <input type="datetime-local" id="date-end" name="timestamp_end">
          </div>
        </div>
        <button type="submit">Search</button>
      </form>
    </section>

    <!-- Results Section -->
    <section id="results-section">
      <div id="loading" class="loading-indicator" hidden>
        <span aria-busy="true">Loading...</span>
      </div>
      <div id="error-message" class="error-message" hidden></div>
      <div id="results-info"></div>
      <table id="results-table" role="grid">
        <thead>
          <tr>
            <th scope="col">Timestamp</th>
            <th scope="col">Project</th>
            <th scope="col">URL</th>
            <th scope="col">Duration</th>
            <th scope="col">Source</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody id="results-body">
          <!-- Populated dynamically -->
        </tbody>
      </table>
      <div id="pagination">
        <button id="load-more" hidden>Load More</button>
      </div>
    </section>

    <!-- Detail Modal (for viewing individual requests) -->
    <dialog id="detail-modal">
      <article>
        <header>
          <button aria-label="Close" rel="prev" id="close-modal"></button>
          <h2 id="modal-title">Request Details</h2>
        </header>
        <div id="modal-content">
          <!-- Populated when viewing a request -->
        </div>
        <footer>
          <button id="modal-close-btn">Close</button>
        </footer>
      </article>
    </dialog>
  </main>

  <footer class="container">
    <small>Bitville APM &copy; 2026 | <span id="status-indicator">Connecting...</span></small>
  </footer>

  <script type="module" src="./app.js"></script>
</body>
</html>
